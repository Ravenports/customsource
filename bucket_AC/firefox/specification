DEF[PORTVERSION]=	65.0
# ----------------------------------------------------------------------------

NAMEBASE=		firefox
VERSION=		${PORTVERSION}
KEYWORDS=		www
VARIANTS=		standard
SDESC[standard]=	Mozilla web browser
HOMEPAGE=		https://www.mozilla.org/en-US/firefox/
CONTACT=		Leonid_Bobrov[mazocomp@disroot.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://download.cdn.mozilla.net/pub/firefox/releases/${PORTVERSION}/source/
			https://archive.mozilla.org/pub/firefox/releases/${PORTVERSION}/source/
DISTFILE[1]=		firefox-${PORTVERSION}.source.tar.xz:main

SPKGS[standard]=	single

OPTIONS_AVAILABLE=	DBUS
OPTIONS_STANDARD=	DBUS
OPT_ON[all]=		DBUS

LICENSE=		MPL:single
LICENSE_FILE=		MPL:stock
LICENSE_TERMS=		single:{{WRKSRC}}/toolkit/content/license.html
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		www/firefox

BUILD_DEPENDS=		python-sqlite3:single:py27
			video4linux:headers:standard
			autoconf213:single:standard
			bzip2:static:standard
			yasm:single:standard
			zip:single:standard
			rust:single:standard
BUILDRUN_DEPENDS=	nss:primary:standard
			libevent:single:standard
			harfbuzz:primary:standard
			libvorbis:primary:standard
			libogg:primary:standard
			libvpx:single:standard
			libffi:single:standard
			sqlite:single:standard
			video4linux:primary:standard
			hunspell:single:standard
			icu:single:standard
			bzip2:shared:standard
			ffmpeg:primary:standard

USES=			cpe desktop-utils:single gmake jpeg perl:build
			pkgconfig png python:py27 zlib
XORG_COMPONENTS=	pixman xcb
GNOME_COMPONENTS=	gconf gdkpixbuf gtk2 gtk3
CPE_VENDOR=		mozilla
MUST_CONFIGURE=		yes
CONFIGURE_OUTSOURCE=	yes
QMAKE_ARGS=		--prefix={{PREFIX:Q}}
			--disable-updater
			--disable-libproxy
			--disable-alsa
			--disable-jack
			--disable-pulseaudio
			--disable-debug
			--disable-debug-symbols
			--disable-dtrace
			--disable-profiling
			--disable-tests
			--disable-webrtc
			--enable-system-cairo
			--enable-system-ffi
			--enable-system-hunspell
			--enable-system-pixman
			--enable-system-sqlite
			--with-system-libevent
			--with-system-harfbuzz
			--with-system-graphite2
			--with-system-icu
			--with-system-nss
			--with-system-nspr
			--with-system-vorbis
			--with-system-ogg
			--with-system-libvpx
			--with-system-zlib
			--with-system-bz2
			--with-system-jpeg={{LOCALBASE}}
			--with-system-png={{LOCALBASE}}
			--with-intl-api
			--with-pthreads
			--enable-release
			--enable-chrome-format=omni
			--enable-default-toolkit=cairo-gtk3
			--enable-optimize
			--enable-gconf
			--enable-pie
			--enable-strip
			--enable-install-strip
			--enable-application=browser
			--enable-official-branding

VAR_OPSYS[freebsd]=	CONFIGURE_ARGS=--enable-jemalloc=4
VAR_OPSYS[linux]=	QMAKE_ARGS=--disable-elf-hack

SUB_FILES=		firefox.desktop
			pkg-install-single
			pkg-deinstall-single
SUB_LIST=		FIREFOX_ICON=firefox.png
			MOZILLA=firefox
			MOZILLA_BIN=firefox-bin
			MOZILLA_NAME=Firefox
			MOZDIR={{PREFIX}}/lib/firefox

[DBUS].DESCRIPTION=			D-Bus IPC system support
[DBUS].QMAKE_ARGS_ON=			--enable-startup-notification
[DBUS].QMAKE_ARGS_OFF=			--disable-dbus
[DBUS].BUILDRUN_DEPENDS_ON=		dbus-glib:primary:standard
					libnotify:primary:standard
					startup-notification:single:standard

pre-configure:
	(cd ${WRKSRC} && ${LOCALBASE}/bin/autoconf-2.13)
	(cd ${WRKSRC}/js/src/ && ${LOCALBASE}/bin/autoconf-2.13)

post-install:
	@${MKDIR} ${STAGEDIR}${PREFIX}/share/pixmaps \
		${STAGEDIR}${PREFIX}/share/applications
	${INSTALL_DATA} ${WRKDIR}/firefox.desktop \
		${STAGEDIR}${PREFIX}/share/applications/
	${LN} -sf ${PREFIX}/lib/firefox/browser/chrome/icons/default/default48.png \
		${STAGEDIR}${PREFIX}/share/pixmaps/firefox.png
