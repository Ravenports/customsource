DEF[ORIGVERSION]=	4.1
DEF[PORTVERSION]=	${ORIGVERSION}
DEF[CCLINKDIR]=		libexec/ccache
# Don't link "CC" because it is same as "cc" on case-insensitive file systems
# CC should not be used anyway as it is specific to Solaris
DEF[CC_COMPILERS]=	cc c++ gcc g++ clang clang++
# ----------------------------------------------------------------------------

NAMEBASE=		ccache4
VERSION=		${PORTVERSION}
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	Fast C/C++ compiler cache tool
HOMEPAGE=		https://ccache.samba.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/ccache/ccache/releases/download/v${PORTVERSION}/
DISTFILE[1]=		ccache-${PORTVERSION}.tar.xz:main

SPKGS[standard]=	complete primary docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

LICENSE=		GPLv3+:primary
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/GPL-3.0.txt
LICENSE_TERMS=		primary:{{WRKSRC}}/LICENSE.adoc
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		devel/ccache

BUILD_DEPENDS=		Zstandard:static:standard
			asciidoc:single:standard
BUILDRUN_DEPENDS=	Zstandard:shared:standard

USES=			cmake perl:build c++:primary
SKIP_CCACHE=		yes
PLIST_SUB=		CCLINKDIR="${CCLINKDIR}"
DISTNAME=		ccache-${ORIGVERSION}
BUILD_TARGET=		all doc

# ccache will build its own zlib since it can't find a suitable one.
# We want this (as opposed to adding zlib as buildrun depends).
# ccache needs to be dependency-free for Ravenports' purposes.

post-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/${CCLINKDIR}
.for compiler in ${CC_COMPILERS}
	${LN} -sf ${PREFIX}/bin/ccache ${STAGEDIR}${PREFIX}/${CCLINKDIR}/${compiler}
.endfor

	${MKDIR} ${STAGEDIR}${STD_DOCDIR}
	${INSTALL_DATA} ${INSTALL_WRKSRC}/doc/MANUAL.html ${STAGEDIR}${STD_DOCDIR}
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/ccache
